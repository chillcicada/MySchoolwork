# 第十讲：传输层协议

## 目录

- [第十讲：传输层协议](#第十讲传输层协议)
  - [目录](#目录)
  - [TCP 传输控制协议](#tcp-传输控制协议)
    - [TCP 服务模式](#tcp-服务模式)
    - [TCP 数据报的特点](#tcp-数据报的特点)
    - [TCP 报文格式](#tcp-报文格式)
    - [建立 TCP 连接](#建立-tcp-连接)
    - [包丢失与重发](#包丢失与重发)
    - [连接释放方式](#连接释放方式)
  - [UDP 用户数据报协议](#udp-用户数据报协议)
    - [UDP 协议](#udp-协议)

## TCP 传输控制协议

### TCP 服务模式

- 端对端服务
- 虚连接
- TCP 把 IP 看作一个包通信系统
- 路由器不需要 TCP 服务

### TCP 数据报的特点

- **面向连接**
- **点对点通信**
- 全双工通信
- 无结构的数据流
- **完全可靠性**
- **有缓冲的传送，实现拥塞控制**

### TCP 报文格式

![](https://img.chillcicada.com/i/2024/05/26/66533fe250686.webp)

### 建立 TCP 连接

TCP 协议建立连接的过程就是一个通信双方序号同步的过程

- A -> B SYN —— 我的序号为 x；
- B -> A SYN & ACK —— 我的序号为 y，你的序号为 x + 1；
- A -> B ACK —— 我的序号为 x + 1，你的序号为 y + 1；

![](https://img.chillcicada.com/i/2024/05/26/66533fec55f59.webp)

### 包丢失与重发

- 等待“接收确认”
- 超时重发
  - 等待时间的确定
  - 延迟时间的变化
- 适应性重发
  - 往返时间的估计加权
  - 变化量的估计
- 发送与接收缓冲区
- 窗口（剩余缓冲区空间）
  - 接收窗口通告
- 拥塞控制
  - 滑动窗口

### 连接释放方式

- 非对称式
  - 任何一方都可以关闭双向连接，存在丢失数据的危险
- 对称式
  - 每个方向的连接单独关闭，双方都执行 DISCONNECT 才能关闭整条连接
  - 使用三次握手 + 定时器的方法释放连接，在绝大多数情况下是成功的

## UDP 用户数据报协议

### UDP 协议

- 简单，无连接
- UDP 增加内容
  - 端口：UDP 能够区分在同一台主机上运行的多个程序
  - 检验和：确认数据有效
