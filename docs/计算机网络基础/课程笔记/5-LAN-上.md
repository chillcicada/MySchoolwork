## 第五讲：局域网 Local Area Network(LAN)

直接点对点通信:

- 优点
  - 独占线路，传输效率高
  - 可以选择通信的细节
  - 安全性高
- 缺点
  - 连接的数量平方增长

$$
直接的连接数量 = C_N^2 = \cfrac{N\cdot(N-1)}{2}
$$

- 共享通信通道

  - 优点:降低费用
  - 缺点:内部协调与管理复杂

- 局域网
  - 将**特定区域内**的各种数据通信设备连接在一起的通信网络
  - 共享技术，**访问的局部性原理**

> 局域网并非地理概念，而是指是否共享通讯介质

### IEEE 802 模型

- 1980年2月国际电子与电气工程师协会发布802规范，强化OSI模型
- 局域网体系结构由物理层、介质访问控制子层（MAC-Media Access Control）
  和逻辑链路控制子层LLC(Logical Link Control)组成

> 在 IEEE 802 模型中，讲主机至网络层分成了三个子层：物理层，MAC 子层，LLC 子层

- 物理层
  - 确保二进制位信号正确传输，位流的正确传送与接收。标准规范
  - 局域网传输介质与拓扑结构
  - 物理接口的机械特性、电气特性、功能特性和规程特性
  - 传输信号的编码方案。局域网常用的编码方案有：曼彻斯特码、差分曼彻斯特码、非归零码、4B/5B 码、8B/6T 和 8B/10B 等。
  - 错误校验码以及同步信号的产生与删除
- MAC 子层（介质访问控制）
  - MAC 是数据链路层的一个功能子层。MAC 直接与物理层相邻。
  - 合理的信道分配，解决信道竞争问题。完成介质访问控制功能，为竞争的用户分配信道使用权，并具有管理多链路的功能。
  - MAC 子层为不同的物理介质定义了介质访问控制标准。IEEE 802 的介质访问控制标准有 CSMA/CD、TokenRing、Token-Bus 等。
- LLC 子层（逻辑链路控制）
  - LLC 子层的功能包括： 数据帧的组装与拆卸、帧的收发、差错控制、数据流控制和发送顺序控制等功能并为网络层提供：面向连接服务和无连接服务。
  - LLC 在 MAC 子层的支持下向网络层提供服务。可运行于所有 802 局域网和城域网协议之上的数据链路协议。
  - LLC 子层与传输介质无关，它独立于介质访问控制方法，隐藏了各种 802 网络之间的差别，向网络层提供一个统一的格式和接口。

### 拓扑与布线

#### 局域网基本拓扑结构

- **星形拓扑**
  - 所有计算机连接在一个中心节点上
  - 各自独占通信信道
- **环状拓扑**
- 计算机连接在一个封闭的环内
- **总线拓扑**
  - 计算机以共享电缆连接，共享信道（无中心节点，多用于以太网）
- 树形
  - 分层结构
- 网状（自由度最大）
  - 结点之间任意联结
  - 连接多个子网或多个局域网

#### 局域网典型布线方案（IEEE 802.3）

- 以太网布线方案一（总线拓扑）
  - 粗缆以太网
    - 网卡
    - 连接单元接口（AUI Attachment Unit Interface）
    - 终结器（相当于电阻，用于**防反射**）
  - 工程特性（10M bps IEEE 标准：10Base-5）
    - 最短收发器间距：2.5 米
    - 每网段最多计算机数：100
    - 最大传输距离：500 米
    - 最大网络长度：2500 米
    - 通过**多用复用器**来扩展计算机数和网络长度（多台计算机共用一个节点）
- 以太网布线方案之二（总线拓扑）
  - 细缆以太网：只用实现电路连接，不再需要连接单元接口，性价比更高
    - 同轴电缆（屏蔽干扰）
    - 安装与运行费用低
    - 使用BNC连接器
    - **不需要外部收发器**
    - 终结器
    - 工程特性（10M bps IEEE 标准：10Base-2）
      - 典型缆线：细缆
      - 最大传输距离：185 米
      - 最短传输距离：0.5 米
      - 每网段最多计算机数：30 台
      - 最大网络长度：925 米
- 以太网布线方案之三（星形拓扑，_总线拓扑_）
  - 双绞线以太网：目前应用最多
    - 也叫 TP 以太网，正式称 10Base-T
    - RJ-45 连接器
    - 集线器 (Hub)
    - 工程特性（10M bps IEEE 标准：10Base-T）
      - 典型缆线：UTP3、4、5 类
      - 连接器：RJ-45
      - 最大传输距离：100 米
      - 最短传输距离：2.5 米

![](https://img.chillcicada.com/i/2024/05/26/66533fb7c8d71.webp)

- 三种布线方案的比较

  - 收发器安装、维护困难
  - 细缆容易破坏
  - 价格

- 10Base-T 的优点
  - 网络扩展方便
  - 线路安装与电话可以同步，节省费用
  - 网络建立灵活、方便
  - 故障定位方便、排除简单
  - 系统整体费用低

### 介质访问控制 MAC

- **总线拓扑实例**(有线局域网)
  - Ethernet
    - 载波侦听多路访问
    - **冲突检测**
    - CSMA/CD (Carrier Sense Multiple Access with **Collision Detection**)
    - 截断二进制指数重发

$$
T=2\tau\times(2^i-1), i\ 为回退次数，\tau\ 为时间常数
$$

```mermaid

```

- 载波侦听过程：查是否已经有结点利用总线在发送数据
- 冲突检测：比较法和编码违例判决法

### IEEE 802.11 无线 LAN

- 无线 LANs: 不拘范围 (经常是移动的) 联网形态
- IEEE 802.11 标准:
- MAC 协议
  - 无需注册的频率范围：2.4GHz（14 信道），5GHz 更多信道，ISM

#### 802.11 MAC层: CSMA/CA (无线局域网)

- 802.11 CSMA: 发送方
  - 如果检测到信道闲置了 DIFS 秒.
  - 然后传输整个帧(无冲突)
  - 如果检测到信道忙，然后进行二进制避退（binary bakeoff）
- 802.11 CSMA 接收方
- 如果接收 OK，等待 SIFS 后返回 ACK

#### **冲突避免**: RTS-CTS 交换

- CSMA/CA: 进行显式的信道预留
  - 发送方: 发送简短的 RTS: request to send
  - 接收方：使用简短的 CTS: clear to send 回应
- CTS 为发送方预留了信道，并通知了其他 (可能是隐蔽的) 站点
- 避免了隐蔽站点的冲突

> 无线局域网内计算机越多，通信效率越低

### 局域网基本拓扑结构实例 802.5

环状拓扑实例：令牌环网（无冲突，依靠介电来通讯）

环状拓扑实例：

- FDDI (Fiber Distributed Data Interconnection)

### 数据帧

`soh` + 帧数据 + `eot`

- 帧(frame)-MAC
  - 帧的格式
  - 保证传输质量（头与尾）
  - 字节填充（长度控制）
  - 传输差错与奇偶校验 -包(packet)的使用-IP
  - 发送与接收方协调
  - 公平占用资源原则

#### 硬件编码

- 帧的识别与接收

  - 物理地址
    - 共享网络
    - 检测每一帧
    - 获取副本
    - 物理地址特性
      - 静态的
      - 可配置的
      - 动态的
      - 广播地址

- 前导码与帧前定界符字段
  - 前导码：7个字节，10101010…101010
  - 帧前定界符：1字节，10101011
- 目的地址和源地址字段
  - 地址字段长度：2 个字段，各 6 个字节
- 帧类型字段
  - 2 个字节，表征帧数据的类型。IP or ARP frame?
- 数据字段
  - LLC 数据字段是帧的数据字段，长度最小为 46 个字节，少于 46 个字节，需要填充
- 帧校验字段
  - 采用 32 位的 CRC 循环冗余校验
  - 校验的范围是：目的地址、源地址、类型、数据字段
- 帧长度
  - 帧的最小长度为 64 字节，最大长度为 1518 字节

#### 局域网布线、接口与物理结构

- 计算机中的网络接口
  - 网络适配器
  - 网线及接口插件（RJ-45）
  - Win XP 硬件管理（P & P）

##### 网卡

- 网络接口板又称为通信适配器(adapter)或网络接口卡 NIC(Network Interface Card) 。
- 网卡和计算机之间的通信则是通过计算机主板上的 I/O 总线以并行传输方式进行的。
- 当网卡收到一个有差错的帧时，它就丢弃此帧而不必通知它所插入的计算机。
- 当网卡收到一个正确的帧时，使用中断来通知该计算机主 CPU 并交付给网络层。
- 当计算机要发送一个 IP 数据报时，就由协议栈向下交给网卡组装成帧后发送到局域网。

##### Ethernet 实现方法

##### 以太网 Ethernet 特点

- 以太网是基带网，它采用基带传输技术。
- 以太网的标准是 IEEE802.3，它使用 CSMA/CD 访问方法。
- 以太网是一种共享型网络，网络上的所有站点共享传输媒质和带宽。当利用率到达 40% 时，网络的响应速度明显降低。
- 以太网是广播式网络，因此，它具有广播式网络的全部特点。
- 以太网支持传输介质类型有 50Ω 基带同轴电缆、无屏蔽双绞线和光纤。
- 以太网所构成的拓扑结构主要是总线型和星型。
- 多种以太网标准，传输速率：10Mb/s、100Mb/s、1000Mb/s。
- 以太网技术先进，又很简单，这是它获得成功的主要原因。
- 以太网技术成熟，价格低廉、易扩展、易维护、易管理。
- 以太网是可变长帧，长度为：64bytes-1518bytes。

### 局域网扩展

- 扩展方法一：光纤扩展 (**物理层**扩展，需要 光调制器)
  - 光纤扩展
    - 延迟短、带宽大
    - 一般用于楼间连接
  - 光纤通讯距离
    - 光纤衰减（0.2dB/km）
    - 信号功率（5dBm）
    - 接收灵敏度（-25dBm）
    - 理论距离（150km）
    - 单模 5km@1Gbps，多模 500m@1Gbps
- 扩展方法二：中继器 (**物理层**扩展)
  - 针对信号衰减
  - 无保留地转送数据 (在放大信号时也放大了噪声)
  - 当一个网段冲突或发生电干扰时，中继器会导致另一个网段出现同样的问题
  - 中继器一般不超过四个 (网段不超过 5 个)
  - 物理层，不处理帧
  - 只能连接同种帧格式的网络
- 扩展方案三：双绞线以太网 + 集线器 (Hub)，集线器级联（更接近与总线型拓扑）
  - 集线器（Hub）是一种特殊的中继器，它可以转接多个网络电缆
  - 当网络上的某条线路或节点出现故障，不会影响网络上其它节点
  - 集线器的主要作用
    - 连接作用：将多个RJ45连接，同时可以将双绞线同细缆/粗缆相连；
    - 放大信号
    - 当HUB 将测到冲突信号时，产生 JAM 信号
    - 自动监测故障站点，从网络上隔离有问题的计算机
- 局域网扩展：**网桥** (**逻辑链路子层**扩展)

  - 工作在数据链路层（也包含物理层）
    - 实现帧的存储和转发
    - 能够处理一个完整的帧
    - 帧的路由过程
    - 目的 LAN 与源 LAN 相同，则丢弃帧
    - 目的 LAN 与源 LAN 不同，则转发帧
    - 目的 LAN 未知，则扩散帧，并逆向学习
  - 网桥有两类：
    - MAC 子层的网桥，在同构网络中作桥接，如 IEEE802.3 和 IEEE802.3 网络
    - LLC 子层网桥可以桥接不同的 MAC 层，如 IEEE802.3 和 IEEE802.5 之间
  - 工作原理：
    - 网桥工作在混杂（promiscuous）方式，接收所有的帧
    - 接收到帧，查询地址/端口对应表
      - 地址/端口对应表的形成
        - 使用帧头部的物理地址
        - 自适应形成各段计算机列表
        - 网桥软件对地址/端口对应表进行不断的更新，并定时检查，删除在一段时间内没有更新的地址/端口项
    - 确定是丢弃还是转发
    - 启动，地址/端口对应表为空，采用洪泛（flooding）方法转发帧
    - 在转发过程中采用逆向学习（backward learning）算法收集 MAC 地址。网桥通过分析帧的源 MAC 地址得到 MAC 地址与端口的对应关系，并写入地址/端口对应表
  - 网桥特点
    - 可以实现更大范围的 LAN 连接
      - 中继器一般只能将最多 5 段以太电缆连接起来而且不能超过一定的距离
      - 网桥不受限制
    - 局域网分隔
      - 将一个负载很重的大 LAN 分隔成使用网桥互连的几个 LAN 以减轻负担；
    - 不同类型的 LAN 连接
    - 选择性转发：过滤功能，隔离错误，提高网络性能
    - 可以提高 LAN 的安全性
      - LAN 普遍采用的是广播式通信方式
      - 部分网桥有隔离广播的功能

- 利用网桥规划局域网络
  - 大楼间桥接
    - 价格便宜
    - 维护方便
    - 干扰小
- 远程桥接
  - 节点通信不频繁
  - 两端均有网桥
  - 带宽窄，费用高
  - 缓冲

#### 交换式局域网（Switch LAN）

- 以太网、FDDI 和令牌环网常被称为传统局域网，它们都是共享介质、共享带宽的共享式局域网
- 交换局域网已成为当今局域网技术的主流之一
- 交换局域网
  - 交换令牌环
  - 交换 FDDI
  - ATM

交换式局域网特点

- 独占传输通道，**独占带宽**
- 允许多对站点**同时通信**，大大地提高了网络的利用率
- 灵活的接口速度；在交换机上可以配置 10Mbps、100Mbps 或者 10Mbps/100Mbps
- 高度的可扩充性和网络延展性,可以与现有网络兼容
- 易于管理、便于调整网络负载的分布，有效地利用网络带宽
- 交换网可以构造“**虚拟网络**”，通过网络管理功能或其他软件可以按业务分类或其他规则把网络站点分为若干个逻辑工作组，每一个工作组就是个虚拟网

交换集线器（交换机）

- 交换式集线器概念
  - 一种网络开关（Switch），实现端口到端口直接转发
    - “交换” 描述了一种设备，该设备可以根据网络信息构造自己的转发表，做出数据转发决策
    - 交换机可以将网络介质分割成很多个“广播子网”
  - 交换式集线器可以同时接收多个端口信息，并可以将这些信息发向多个目标地址对应的端口
- 组成
  - 端口
  - 缓冲区
  - 信息帧的转发机构
  - 背板体系结构

### 光纤分布式数据接口 FDDI (Fiber Distributed Data Interface)

特征

- 使用光纤作为传输介质
- MAC 协议与 Token Ring 类似
- 通常作为连接 LAN 的主干网络
- 100Mbps 的速率
- 最大距离 200 公里
- 最多 500 个站点
- 最大帧长度 4500Bytes

- FDDI 的双环操作
- 为提高信道利用率，站点发完数据后立即产生新令牌，环上可能同时存在多个帧
- 帧格式

### 异步传输模式 ATM (Asynchronous Transfer Mode)

- 为高速数据传输和通过公共网或专用网传输多种业务数据而设计
- ATM 在 1989 年产生，后被国际电讯联盟标准化组织 ITU-T 确定为传输语音、图像、数据和多媒体信息的工具
- 开发 ATM 的目标：用于宽带综合业务数据网（B-ISDN）
- 由于实施的复杂性，ATM 最终首先被用于局域网
- ITU-T、ATM 论坛、ANSI（美国国家标准协会）、ETSI（欧洲电信标准协会）和 IETF（Internet 工程任务组）等标准化组织为 ATM 定义了一系列标准，使 ATM 技术在局域网建设中很快被推广应用
- 现在 ATM 已成为局域网主干网的主流技术之一

### 快速以太网 (Fast Ethernet)

- 传输速率比普通 Ethernet 快 10 倍，数据传输速率达到了 100Mb/s
- 保留着传统的帧格式、介质访问控制方法与组网方法
- 每个比特的发送时间由 100ns 降低到了 10ns
- 1995 年 9 月，IEEE 802 委员会正式批准标准 IEEE 802.3u

以太网提速的可能方案

- 减小工作距离
- 用2对以上的线
- 用新类型的线
- 改变编码方式

- 100Base-T
  - 100Base-X(4B5B 编码，5 个时钟周期发送 4 个比特，物理层与 FDDI 兼容)
    - 100Base-TX
      - 5 类双绞线使用 125 MHz 的信号；
      - 使用 2 对 5 类平衡双绞线或50$\Omega$屏蔽平衡电缆，全双工；
    - 100Base-FX
      - 使用 2 根多模光纤，全双工
  - 100Base-T4： 对 ISO/IEC 11801 定义的 3 类（或更好）双绞线;
    - 3 类非屏蔽双绞线（UTP），使用 25MHz 的信号
    - 8B/6T（8 bits map to 6 trits）编码，使用三进制信号（ternary signals），1对双绞线的比特率为 $25\times\cfrac{8}{6} = 33.3 Mbps；
  - 100Base-T2：
    - 2 对 ISO/IEC 11801 定义的 3 类（或更好）双绞线;
    - PAM5\*5 编码（4 位半字节数据编成 5 个电平的脉冲振幅调制系统的编码）
- 10/100M 自动协商模式
  - 加电发送快速链路突发脉冲序列，表明自身链路类型。
  - 100BaseT2，100BaseT4，100BaseTX，10BaseT。

### 千兆以太网 (Gigabit Ethernet)

- 千兆以太网(GE-Gigabit Ethernet)是提供 1000Mbps 数据传输速率的以太网
- 千兆以太网支持全双工操作，最高速率可以达到 2Gbps
- 千兆以太网系统采用 8B/10B 编码方案，并以 1.25G 波特的速率在信道上发送信号，以达到 1Gbps 传输速率
- 千兆以太网的物理层标准规定了 4 种介质标准

<!-- todo -->
